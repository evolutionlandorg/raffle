# Raffle

[IPO摇号算法](http://ir.nsfc.gov.cn/paperDownload/1000008694999.pdf)

用户可以通过抵押NFT和相应面值的RING来抽奖, 用户抵押的金额越多中奖概率越大.
1. 土地配额`landQuota`.
2. 参与的土地`lands`, 总参与的长度`totalLength`(每个土地抵押的balance之和).
3. 步长`d = totalLength / landQuota`.

如果参与情况如下:  
```
landQuota: 3
totalLength: 1+2+3+4+5=15  
[1,2) [2,4) [4, 7) [7,11) [11,16)
d = 15 / 3
  = 5

如果摇出来的号是: 2
则中奖的分别是: 2, 7, 12
对应的是: 第二个, 第四个, 第五个.

如果最后一个人的抵押金额变大为17, 则:
totalLength: 1+2+3+4+17=27
[1,2) [2,4) [4, 7) [7,11) [11,28)
d = 27 / 3
  = 9

中奖的分别是: 2, 11, 18
对应的是分别: 第二个, 第五个, 第五个.
这个时候第五个被摇中两次, 需要剔除第二个和第五个地块, 进行第二次摇号.
```

综上,计算过程需要遍历摇号的土地列表, 和基于摇号列表长度的大量内存, 建议公开摇号算法,将摇号的过程放在链下, 由supervisor对摇号结果签名.

